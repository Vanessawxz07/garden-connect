# 用户中心隐私设置需求 PRD

## 一、需求概述

### 1.1 需求背景
- 当前用户中心仅支持用户查看自己的个人信息，功能单一
- 缺乏社交属性，无法查看其他用户主页
- 需要增加更丰富的内容展示模块

### 1.2 需求目标
- **社交化**：支持用户访问其他用户主页，建立关注关系
- **隐私保护**：提供细粒度的隐私设置，用户可自主控制信息可见性
- **内容丰富**：增加多个内容展示模块（动态、交易、收藏、宠物图鉴等）
- **合规性**：符合GDPR/PIPL等隐私法规要求，确保用户知情同意

---

## 二、用户角色与视图定义

### 2.1 主人态（Owner View）
- **路由**：`/profile`
- **访问权限**：仅用户本人
- **主要操作**：查看完整个人信息、编辑资料、设置隐私权限、查看私密内容
- **主按钮**：「设置」按钮（右上角）

### 2.2 访客态（Visitor View）
- **路由**：`/user/:userId`
- **访问权限**：所有用户（根据隐私设置控制可见内容）
- **主要操作**：查看公开信息、关注/取消关注用户
- **主按钮**：「关注」/「已关注」按钮（右上角）

### 2.3 自己的访客态（Self-Visitor View）
- **路由**：`/user/:userId`（自己的userId）
- **表现形式**：与主人态一致，显示「设置」按钮
- **说明**：当用户访问 `/user/自己的ID` 时，展示与 `/profile` 相同的内容和权限

---

## 三、页面布局与模块设计

### 3.1 页面整体布局
<img width="607" height="764" alt="局部截取_20251130_221616" src="https://github.com/user-attachments/assets/1b825d04-5122-4952-abe3-035e7d461894" />

```
┌─────────────────────────────────────────────────────┐
│  Navigation Bar                        │
├─────────────────────────────────────────────────────┤
│                                                       │
│  ┌─────────────────────────────────────────────┐   │
│  │         个人信息头部区域                       │   │
│  │  ┌──────┐                                    │   │
│  │  │ 头像  │  用户名                 标签1 标签2  │   按钮 [设置]/[关注] │
│  │  │ 88x88│  @username                         │   │
│  │  └──────┘  个人简介...                        │   │
│  │                                               │   │
│  │  关注 120  |  粉丝 340  |  注册时间 2024-01  │   │
│  │  在线状态：● 当前在线                          │   │
│  └─────────────────────────────────────────────┘   │
│                                                       │
│  ┌─────────────────────────────────────────────┐   │
│  │ Tab导航                                       │   │
│  │ [动态] [交易记录] [收藏] [宠物图鉴]             │   │
│  ├─────────────────────────────────────────────┤   │
│  │                                               │   │
│  │         Tab内容区域                            │   │
│  │                                               │   │
│  └─────────────────────────────────────────────┘   │
│                                                       │
└─────────────────────────────────────────────────────┘
```

### 3.2 个人信息头部区域
以下未单独说明的，均默认为始终公开，不受隐私设置控制。

#### 3.2.1 头像
默认头像，仅展示，不可交互

#### 3.2.2 用户名与用户ID
- **用户名**：大号字体，粗体，显示在头像右侧

#### 3.2.3 用户标签
- **位置**：用户名下方
- **样式**：圆角徽章，不同颜色区分标签类型
- **类型示例**：
  - VIP用户（金色）
  - 活跃用户（蓝色）
- **来源**：VIP用户由运营在后台为指定用户打标（非用户自定义）
- **数据库设计**：`user_tags` 表，字段包含 `user_id`, `tag_name`, `tag_color`, `tag_icon`
- **机制化标签**：支持数据驱动的机制化标签（如：完成交易次数>=3 or 活跃天数>5，则授予“活跃用户”标签）

#### 3.2.4 个人简介
- **位置**：用户名/标签下方
- **字数限制**：最多200字符（不支持展示url；待讨论-如何防止用户在个人简介中展示钓鱼诱导信息）
- **主人态**：显示编辑按钮
- **访客态**：仅展示
- **默认值**：空时显示"这个人很懒，什么都没写~"（仅主人态可见）

#### 3.2.5 统计数据

**交易数据**
现网已有逻辑：
- Successful Trades: X
- Total Trades: Y
- Pets Owned: Z
- 纠纷: Z (新增字段-该用户被举报次数，该字段需增加hover信息提示“交易中report的次数”)

**粉丝数**
- **显示格式**：`粉丝 340`

**关注数**
- **显示格式**：`关注 120`
  
**注册时间**
- **显示格式**：`注册时间 年月日`（精确到日）

#### 3.2.6 在线状态
- **显示格式**：`● 当前在线` / `○ 离线`
- **在线判定**：用当前默认逻辑
- **偏好在线时间**：用户设置常在线时间段（已有逻辑，调整展示位置）


### 3.3 Tab导航设计

#### 3.3.1 Tab列表
1. **动态**（本次实现）
2. **交易记录**（已有tab）
3. **收藏**（V2迭代，本次占位）
4. **宠物图鉴**（V2迭代，本次占位）

#### 3.3.2 Tab样式
- **未选中态**：灰色文字，无下划线
- **选中态**：主题色文字，底部有选中状态的下划线
- **Hover态**：文字颜色加深，光标变为pointer
- **移动端适配**：支持横向滑动切换

#### 3.3.3 Tab权限说明
每个Tab在隐私设置中都有独立的可见性控制：
- **仅自己可见**：只有主人态可查看
- **所有人可见**：所有访客都可查看

---

## 四、Tab内容模块详细设计

### 4.1 动态 Tab（本次实现）

#### 4.1.1 内容说明
- 展示用户发起或参加的所有抽奖活动（Giveaways）
- VIP用户的动态post（非本期需求，在后续迭代增加）

#### 4.1.2 数据来源
- 查询 `giveaways` 表，`vip_user_id` = 当前profile的用户ID
- 按创建时间倒序排列

#### 4.1.3 展示内容
- 使用 `GiveawayCard` 组件
- 卡片布局：瀑布流式长条卡片，响应式
- 支持数字分页切换（使用组件），默认单页xx个活动

#### 4.1.4 空状态
- **主人态**：显示"你还没有发起过任何抽奖活动"，提供「创建抽奖」按钮（若有VIP权限则可直接发起抽奖；如无抽奖功能权限，则按钮引导进入discord子频道申请）
- **访客态**：显示"该用户还没有发起过任何抽奖活动"

#### 4.1.5 默认隐私设置
- **默认**：所有人可见
- **可配置**：在隐私设置中关闭开关（即访客不可见）

#### 4.1.6 访客态访问被限制时的展示
- 显示锁定图标🔒或图片
- 提示文案：示意"人家不给你看哦"

### 4.2 交易记录 Tab

#### 4.2.1 内容说明
展示用户的Roblox道具交易记录，本需求中暂不更新功能，后续迭代支持按自己发布、参与的交易分类，并复用搜索、排序等公共组件。

#### 4.2.2 默认隐私设置
- **默认**：仅自己可见，支持手动开放
- **原因**：交易记录涉及敏感信息，默认私密


### 4.3 收藏 Tab（本次占位）

#### 4.3.1 内容说明
展示用户收藏的抽奖活动或道具

#### 4.3.2 占位实现
- 显示"Coming soon..."

#### 4.3.3 默认隐私设置
- **默认**：仅自己可见，支持手动开放

#### 4.3.4 V2迭代规划
- 支持收藏交易、文章、道具及关注用户
- 网格布局展示收藏内容
- 数据来源：需新建 `user_favorites` 表

### 4.4 宠物图鉴 Tab

#### 4.4.1 内容说明
展示用户拥有的宠物图鉴，来源为使用宠物管理功能所识别出的道具。

#### 4.4.3 默认隐私设置
- **默认**：仅自己可见，支持手动开放

---

## 五、关注功能详细设计

### 5.1 关注按钮

#### 5.1.1 按钮位置
- 页面右上角
- 在访客态时显示

#### 5.1.2 按钮状态
**未关注状态**
- 图标+文案：「Follow」

**已关注状态**
- 图标+文案：「Followed」
- Hover时显示：「取消关注」

**加载状态**（如耗时少则不需要）
- 文案：「处理中...」
- 按钮禁用，显示loading spinner

#### 5.1.3 关注/取消关注交互
1. 点击「关注」按钮
2. 按钮进入加载状态
3. 发送关注请求到后端
4. 成功后：
   - 按钮状态变为「已关注」
   - 用户的粉丝数+1
   - 当前访客的关注数+1
   - Toast提示："已关注 @username" （使用已有的提示组件）
5. 失败时：
   - 显示错误Toast
   - 按钮恢复到「关注」状态

#### 5.1.4 取消关注确认
- Hover「已关注」按钮时，文案变为「取消关注」，背景变色
- 点击按钮后执行取消关注操作

---

## 六、隐私设置功能详细设计

### 6.1 设置入口

#### 6.1.1 入口位置
- 主人态页面右上角「设置」按钮 
- 点击后跳转到 `/settings/privacy` 页面
- 原弹窗中设置在线时间，将所有样式和交互、数据逻辑迁到页面中，设置中包括隐私、在线时间两类，点击tab切换

#### 6.1.2 样式
用文案+开关按钮示意该项内容模块设置打开/关闭

### 6.2 隐私设置页面布局
双列布局（左侧导航，右侧内容）; 样式参考示意图
<img width="362" height="452" alt="局部截取_20251130_221442" src="https://github.com/user-attachments/assets/de81da5d-774a-48d9-987b-50d5febfaa3b" />

```
```

#### 6.2.1 设置页面合规文案
在隐私设置页面顶部增加说明卡片：
```
ℹ️ 隐私说明
我们尊重你的隐私，并为你提供完全的控制权。
你可以自主选择每项信息的可见范围，我们不会未经你的同意分享你的个人信息。
敏感信息（如交易记录）默认为私密状态，只有你自己可见。
```
#### 6.2.2 每个设置项的说明文案
在每个设置项下方增加简短说明（灰色小字）：
- **动态**："你发起的抽奖活动"
- **交易记录**："你的道具交易历史，涉及敏感信息，建议仅自己可见"
- **收藏**："你收藏的内容"
- **宠物图鉴**："你拥有的宠物收藏"

### 6.3 隐私设置项详细说明

#### 6.3.1 主页可见性
不支持设置，默认公开

#### 6.3.2 个人信息
不支持设置，默认公开

#### 6.3.3 内容模块可见性

**动态**
- **选项**：所有人可见 / 仅自己可见
- **默认值**：所有人可见

**交易记录**
- **选项**：所有人可见 / 仅自己可见
- **默认值**：仅自己可见（敏感信息）

**收藏**
- **选项**：所有人可见 / 仅自己可见
- **默认值**：仅自己可见

**宠物图鉴**
- **选项**：所有人可见 / 仅自己可见
- **默认值**：仅自己可见


### 6.4 隐私设置保存

#### 6.6.2 保存流程
1. 点击「保存设置」按钮
2. 按钮进入加载状态：「保存中...」
3. 发送更新请求到后端
4. 成功后：
   - Toast提示："隐私设置已保存"
   - 2秒后自动返回个人中心
5. 失败时：
   - 显示错误Toast："保存失败，请重试"
   - 按钮恢复到「保存设置」状态


### 6.5 隐私设置初始化

#### 6.5.1 新用户注册时
自动创建 `user_privacy_settings` 记录，使用默认值

#### 6.5.2 老用户迁移
- 一次性批量创建


---

## 七、首次更新通知与合规设计

### 7.1 通知触发时机
- 用户在本次功能上线后首次登录时触发
- 使用 `localStorage` 或数据库字段记录用户是否已查看通知
- 显示次数：最多2次
  - 第1次：首次登录时弹出
  - 第2次：第2次登录时弹出（如果第1次点击了"稍后再说"）
  - 如果用户两次都点击"稍后再说"，则不再主动弹窗

### 7.2 通知弹窗设计

#### 7.2.1 弹窗样式
- 类型：模态对话框（Modal Dialog）
- 尺寸：中等大小（max-width: 500px）
- 遮罩：半透明黑色背景
- 位置：屏幕居中
- 关闭方式：
  - 必须点击主次按钮
  - 不支持点击弹窗关闭按钮、遮罩或ESC关闭（确保用户知情）

#### 7.2.2 弹窗内容

```
┌───────────────────────────────────────────────┐
│                    ✨                          │
│           个人主页全新升级！                   │
│                                                │
│   你的个人主页现在更加丰富和社交化了！          │
│                                                │
│   新功能亮点：                                 │
│   🔹 支持其他用户访问你的主页                  │
│   🔹 关注功能，与好友建立连接                  │
│   🔹 展示你的动态、交易和收藏                  │
│   🔹 细粒度的隐私控制，保护你的信息            │
│                                                │
│   隐私提醒：                                   │
│   为了保护你的隐私，我们为你设置了默认的       │
│   隐私选项。你可以随时在设置中调整：           │
│   • 交易记录默认仅自己可见                     │
│   • 你可以自主控制每项信息的可见范围           │
│                                                │
│   ┌─────────────────┐  ┌──────────────────┐  │
│   │   前往设置       │  │   稍后再说        │  │
│   └─────────────────┘  └──────────────────┘  │
│  查看隐私政策                                              │
└───────────────────────────────────────────────┘
关联：隐私政策法律文件需更新
```

#### 7.2.3 按钮说明

**前往设置**
- 样式：主要按钮（Primary）
- 行为：
  - 关闭弹窗
  - 跳转到 `/settings/privacy` 页面
  - 记录用户已查看通知（不再重复显示）

**稍后再说**
- 样式：次要按钮（Secondary）
- 行为：
  - 关闭弹窗
  - 增加查看次数计数
  - 如果查看次数 < 2，下次登录时再次显示
  - 如果查看次数 >= 2，不再显示


### 7.3 数据存储方案

#### 7.3.1 方案：LocalStorage（推荐用于本次实现）
**优点**：
- 实现简单，无需数据库迁移
- 性能好，不增加服务器负担
**缺点**：（可接受）
- 清除浏览器数据会重置
- 无法跨设备同步


### 7.4 隐私合规说明

#### 7.4.1 合规原则
- **知情同意**：通过弹窗明确告知用户新功能和隐私设置
- **数据最小化**：敏感信息（如交易记录）默认仅自己可见
- **用户控制**：提供细粒度的隐私设置，用户可自主选择
- **透明度**：在设置页面提供清晰的说明文案
- **数据访问权**：用户可随时查看和修改自己的隐私设置

---

## 八、路由设计

### 8.1 路由列表
| 路由 | 说明 | 访问权限 |
|------|------|---------|
| `/profile` | 个人中心（主人态） | 仅登录用户本人 |
| `/user/:userId` | 用户主页（访客态/主人态） | 根据隐私设置控制 |
| `/settings/privacy` | 隐私设置页面 | 仅登录用户本人 |

### 8.2 路由跳转逻辑

#### 8.2.1 `/profile` 路由
- 未登录用户访问：重定向到 `/login`
- 已登录用户访问：展示主人态页面

#### 8.2.2 `/user/:userId` 路由
- 检查 `userId` 是否为当前登录用户
  - 是：展示主人态（与 `/profile` 相同）
  - 否：根据隐私设置展示访客态或403页面

#### 8.2.3 隐私权限检查流程
```
访问 /user/:userId
    ↓
是否为本人？
    ↓ 是
  展示主人态
    ↓ 否
查询目标用户的隐私设置
    ↓
profile_visibility = ?
    ↓ public
  展示访客态（所有公开内容）
```

---

## 九、样式与交互细节

### 9.1 错误状态
用户不存在
```
┌─────────────────────────────────────────────┐
│                                              │
│              😕                              │
│                                              │
│          用户不存在                           │
│                                              │
│     该用户可能已注销或ID输入错误              │
│                                              │
│         [返回首页]                            │
│                                              │
└─────────────────────────────────────────────┘
```

---

## 十、测试用例设计

### 10.1 功能测试

#### 10.1.1 主人态访问
- [ ] 访问 `/profile`，正确展示个人信息
- [ ] 显示「设置」按钮
- [ ] 可以查看所有Tab内容（包括私密内容）
- [ ] 所有统计数据正确显示

#### 10.1.2 访客态访问
- [ ] 访问 `/user/:userId`（其他用户），正确展示公开信息
- [ ] 显示「关注」/「已关注」按钮
- [ ] 根据隐私设置隐藏不可见内容
- [ ] 点击关注按钮，关注成功

#### 10.1.3 隐私权限控制
- [ ] 当用户设置某tab内容私密后，则其他用户不可访问

#### 10.1.4 关注功能
- [ ] 点击「关注」，关注成功，按钮变为「已关注」
- [ ] Hover「已关注」，显示「取消关注」，点击弹出确认对话框
- [ ] 确认取消关注，成功取消，按钮变为「关注」
- [ ] 关注后，粉丝数+1，取消关注后粉丝数-1

#### 10.1.5 隐私设置
- [ ] 打开隐私设置页面，正确展示当前设置
- [ ] 修改设置后点击保存，成功保存并返回个人中心
- [ ] 修改设置后不保存直接离开，设置未生效

#### 10.1.6 首次更新通知
- [ ] 新用户首次登录，显示更新通知弹窗
- [ ] 点击「前往设置」，跳转到隐私设置页面，不再重复显示
- [ ] 点击「稍后再说」，关闭弹窗，下次登录再次显示
- [ ] 点击2次「稍后再说」后，不再显示弹窗


### 10.2 边界测试

#### 10.2.1 数据边界
- [ ] 用户无粉丝时，显示"粉丝 0"
- [ ] 用户无关注时，显示"关注 0"
- [ ] 用户无动态时，显示空状态
- [ ] 个人简介超过200字符时，截断显示

#### 10.2.2 权限边界
- [ ] 未登录用户访问 `/profile`，重定向到 `/login`
- [ ] 访问不存在的用户ID，显示404页面
- [ ] 自己关注自己，显示错误提示

#### 10.2.3 并发操作
- [ ] 同时点击多次「关注」按钮，只发送一次请求
- [ ] 在保存设置过程中刷新页面，设置正确保存或回滚


---

## 十一、当前版本feature list

### 11.1 V1.0（本次实现）✅
**目标**：建立基础的用户主页和隐私设置功能

**功能清单**：
- [x] 主人态页面（`/profile`）
- [x] 访客态页面（`/user/userId`）
- [x] 个人信息头部区域（头像、用户名、标签、简介、统计数据、在线状态）
- [x] Tab导航（动态、交易记录、收藏、宠物图鉴）
- [x] **动态Tab**：展示用户发起的抽奖活动
- [x] **交易记录Tab**：复用
- [x] **收藏Tab**：占位状态
- [x] **宠物图鉴Tab**：首期可为占位状态
- [x] 关注/取消关注功能
- [x] 隐私设置页面（`/settings/privacy`）
- [x] 内容模块可见性设置
- [x] 首次更新通知弹窗（显示2次逻辑）
- [x] 权限验证（前端+后端+RLS）
- [x] 响应式设计
- [x] 用户标签系统（运营后台打标）

## 十二、后续版本规划
### 12.2 V2.0（后续迭代）🔄

#### 12.2.8 用户标签增强
- [ ] 支持数据驱动的机制化标签（交易次数、登录天数等）
- [ ] 标签获得记录和说明

### 12.3 V3.0（未来规划）🚀

#### 12.3.1 社交功能增强
- [ ] 私信功能
- [ ] VIP用户发布动态post功能、post评论、点赞功能

#### 12.3.3 成就系统
- [ ] 成就徽章展示
- [ ] 成就获得记录
- [ ] 成就墙（展示所有成就）


---

## 十三、附录

### 13.1 相关文档链接
- [抽奖功能PRD](./抽奖功能PRD.md)
- [用户认证流程文档](待补充)
- [隐私政策](待更新)

### 13.2 术语表
| 术语 | 说明 |
|------|------|
| 主人态 | 用户查看自己的个人主页时的视图状态 |
| 访客态 | 用户查看其他人的个人主页时的视图状态 |
| 抽奖/Giveaways | 用户发起的抽奖活动（Giveaways） |


### 13.4 更新日志
| 版本 | 日期 | 更新内容 | 作者 |
|------|------|---------|------|
| 1.0 | 2024-11-30 | 初始版本，完整PRD | Vanessa |

---

**PRD编写完成时间**：2024-11-30
**预计开发周期**：1周
**预计上线时间**：2024-12-中旬
