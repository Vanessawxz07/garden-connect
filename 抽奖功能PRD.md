# 抽奖功能产品需求文档 (PRD) v1.4

## 📋 一、概述

### 核心价值
- **平台运营**：提升用户活跃度和留存率，建立健康的社交生态
- **VIP创作者**：通过抽奖活动吸引和维护粉丝群体，提升个人影响力
- **普通用户**：通过关注喜爱的VIP获得奖品机会，享受参与乐趣

### 上线目标
在**2025年12月20日前**，以便支持双节活动上线。

### 关注
本期设计实现方案时，应考虑拓展性，即未来能相对容易的兼容平台新增其他游戏的抽奖活动。

---

## 👥 二、用户角色

### 1. VIP用户（抽奖发起者）
**画像**：平台活跃的内容创作者、交易大户、社区意见领袖

**核心需求**：快速创建抽奖活动，选择奖品和设置规则，简化的定时开奖机制；通过抽奖吸引新粉丝关注 

### 2. 普通用户（参与者）
**画像**：平台活跃用户，对游戏道具有需求，喜欢社交互动

**核心需求**：快速发现感兴趣的抽奖活动，一键参与抽奖（自动关注VIP）；查看自己参与的抽奖记录，了解结果与状态

### 3. 平台运营
**核心需求**：手动审核和授予VIP权限；后续数据分析和运营决策支持

---

## 🎯 三、功能需求拆分

### 前置条件（基础设施）

| 功能模块 | 功能描述 | 技术要点 |
|---------|---------|---------|
| **用户角色和权限分级** | 安全的角色权限管理 | 不同用户的功能权限区分 |
| **奖品库** | 道具、token数据管理 | 包括道具和token，及对应名称、图片、数量、价值等交易关键字段 |
| **关注系统** | 用户关注关系 | user_follows表，支持关注/取关 |

### P0：核心功能与逻辑

**主要流程**
<img width="1529" height="454" alt="局部截取_20251208_123956" src="https://github.com/user-attachments/assets/5060031f-0a6c-4e12-a534-a71d057ce037" />


#### 抽奖活动生命周期-状态定义
```
创建 → 进行中 → 开奖 → 已开奖 → 已交接/过期失效

状态说明：
- created: 刚创建，未开始
- ongoing: 进行中，即处于报名参与期
- drawing: 正在开奖（锁定状态，不支持报名）——待讨论，如抽奖过程极短，不需要展示抽奖过程，则无需该状态
- ended: 已开奖，不管是否完成奖品交接都进入此状态
- completed: 已交接，任一方（发奖者或中奖者）完成确认交接即变更为此状态
- expired: 过期失效，开奖后14天内双方均未确认交接，则自动变为此状态
- （后续-支持取消）cancelled: 已取消

状态互斥规则：
- ended与completed/expired互斥：开奖后先进入ended状态
- completed与expired互斥：以是否完成交接区分，只能存在一个
```

以下为具体功能与逻辑：
#### 1. **个人主页-有发起抽奖权限**
- **个人主页**
  - "动态"tab中展示Giveaway列表：按开奖时间倒序，不同状态的抽奖展示对应状态标签
  - **分类展示**：
    - **"My Giveaways"**：该用户创建的所有抽奖活动
      - 主态：展示自己创建的抽奖
      - 客态：展示该VIP创建的抽奖（标题改为"[用户名]'s Giveaways"）
    - **"Participated Giveaways"**：该用户参与的抽奖活动
      - 主态：展示自己参与的抽奖
      - 客态：根据隐私设置决定是否可见
  - 长条卡片样式，包含：
    - 奖品图片
    - 参与条件（如"Requirements: 50 users join"）
    - 参与进度条
    - 当前参与人数
    - "VIEW"按钮进入详情页；发起者不能参加本人的抽奖，因此不展示"JOIN NOW"的参与按钮
    - 分享按钮

##### 1.2 VIP抽奖发起
- **创建抽奖活动**：拉起抽奖配置弹窗

**创建抽奖弹窗UI设计**
```
+-------------------------------------------------------------+
|                    Create Giveaway                           |
|                           ✕                                 |
+-------------------------------------------------------------+
| Prize *                                                      |
| [Select Prize]  ← 点击拉起道具选择器                          |
| (Choose one item from your inventory)                        |
+-------------------------------------------------------------+
| Title *                                                      |
| [Enter giveaway title...]                                    |
| (Max 50 characters)                                          |
+-------------------------------------------------------------+
| Description                                                  |
| [Describe your giveaway...]                                  |
| (Optional, max 500 characters)                               |
+-------------------------------------------------------------+
| Registration Period *                                        |
| Start: [Date Picker] [Time Picker]                          |
| End:   [Date Picker] [Time Picker]                          |
| ⚠️ Draw time must be within 30 days from now                |
+-------------------------------------------------------------+
| Draw Time                                                    |
| [Auto-generated based on registration end time]  (Read-only) |
+-------------------------------------------------------------+
| Campaign (Optional)                                          |
| [Select Campaign ▼]                                          |
| (Link to an ongoing platform campaign)                       |
+-------------------------------------------------------------+
| Requirement                                                  |
| ✓ Follow you to participate (Default, cannot be changed)    |
+-------------------------------------------------------------+
|                    [CANCEL]    [CREATE]                      |
+-------------------------------------------------------------+
```

**字段说明：**
| 字段 | 必填 | 说明 |
|-----|-----|-----|
| Prize | ✅ | 从道具库选择，支持token或普通道具 |
| Title | ✅ | 活动标题，限50字符 |
| Description | ❌ | 活动描述，限500字符 |
| Registration Period | ✅ | 报名时间段，精确到分钟 |
| Draw Time | 自动 | 根据报名截止时间自动生成，不可修改 |
| Campaign | ❌ | 下拉选择运营预配置的活动名称 |
| Requirement | 默认 | 本期固定为"关注发奖者"，不可更改 |

**时间限制**：报名截止时间/开奖时间不能超过创建时间起30天，以保持活动节奏

- **查看抽奖活动**
  - 查看活动参与人数统计、活动状态等（用户中心动态tab、抽奖详情页）
  - （mvp阶段先不支持取消或编辑抽奖，后续再加-如报名开始之前可支持取消或修改）

##### 1.3 **个人主页-无抽奖权限**
> **说明**：VIP角色和抽奖功能权限由运营在管理后台授予，普通用户可通过Discord频道申请。

- **申请入口**
  - 用户个人主页 → 动态Tab → 空状态中的按钮（参见「用户隐私设置PRD」5.1.4节）
  - 按钮文案：「Create Giveaway」


#### 2. 用户参与抽奖
- **发现抽奖入口**
  - 首页顶部giveaway数量拉取入口（支持点击）、活动页（giveaway聚合页）的抽奖列表；用户主页的tab（已参与抽奖）

- **参与流程**
  - 发现抽奖活动后，点击「JOIN NOW」按钮
  - 弹出**参与确认弹窗**：
    ```
    +-------------------------------------------------------------+
    |                    Join Giveaway                             |
    |                           ✕                                 |
    +-------------------------------------------------------------+
    | Requirement: Follow [VIP Name] to participate                |
    |                                                              |
    | By joining, you will:                                        |
    | ✓ Auto-follow [VIP Name]                                    |
    | ✓ Get [Avatar] Fan badge (14 days)                          |
    | ✓ Receive notification when you win                         |
    |                                                              |
    | ⚠️ Prize must be claimed within 14 days after draw.         |
    +-------------------------------------------------------------+
    |                    [CANCEL]    [CONFIRM]                     |
    +-------------------------------------------------------------+
    ```
  - 点击确认后：
    - 未关注则自动关注VIP
    - 获得粉丝铭牌（`[Avatar] Fan`样式，14天有效期）
    - 参与成功
  - 已关注则直接参与成功
  - 展示参与成功提示Toast，方案"Joined successfully! Please remember come back to get your result."

- **参与记录**
  - 个人中心：我参与的抽奖列表、抽奖活动状态

### . 参与条件
```
1. 用户必须已登录账号
2. 用户必须关注该VIP（未关注则自动关注）
3. 抽奖活动处于"进行中"状态
4. 用户未重复参与同一抽奖
5. 用户并非该抽奖的创建者
```


##### 2.1 **粉丝铭牌（Fan Badge）**
获取方式: 用户通过参与抽奖自动关注VIP时，获得该VIP的粉丝铭牌。

##### 展示样式
```
+-------------------+
| [VIP头像] Fan     |
+-------------------+
```
- 样式：圆形小头像 + "Fan"文字
- 头像尺寸：与其他标签高度一致
- 点击行为：点击后跳转至该VIP的用户主页

##### 有效期
- 默认有效期：从获得之日起**14天**
- 过期后自动隐藏，不再展示

##### 展示位置与规则
粉丝铭牌与用户身份标签展示在同一位置：
1. **身份标签**（如Official等）固定在第一位
2. **粉丝铭牌**按获得时间倒序排列
3. **显示上限**：与其他标签一起计算总数（下方为标签总数），保持原有逻辑
   - 个人主页：最多8个（超出不展示）
   - 其他场景：3个 + "more"按钮

##### 设计要点
- 视觉上需与身份标签有所区分，体现趣味性和社交属性；头像使设计上有辨识度，吸引其他用户点击查看。鼓励用户通过参与多个抽奖收集不同VIP的粉丝铭牌


#### 3. 定时开奖**
- **自动开奖机制**
  - 支持设定抽奖的报名时间范围，到报名时间截止时即为开奖时间，到时自动触发抽奖/开奖（同时）
  - 随机算法抽取获奖者（已关注且参与的用户，所有用户中奖机率相同；未来可考虑引入积分体系，增加中奖机率，本期不用）

- **开奖逻辑（MVP-定时开奖）**：
  1. 到达设定时间自动触发
  2. 检查有效参与者（已关注+已参与）
  3. 随机抽取指定数量获奖者
  4. 生成中奖记录
  5. 触发机制化的中奖通知

未中奖处理：保留参与记录


#### 4. 中奖通知与领取
**开奖后系统行为**：
```
开奖完成后，系统自动执行以下操作：

1. 创建中奖记录
2. 发送站内通知给中奖者（系统消息）
3. 发送站内通知给发奖者（系统消息）
4. 自动创建发奖者与中奖者的聊天会话（参考交易成功时拉起聊天的逻辑）

``` 
- **奖品领取**：双方通过聊天沟通游戏中奖品交接，并上传确认交接的截图
  

**领奖与交接流程** 集成聊天系统

##### 4.1.1 系统消息通知
<img width="1020" height="380" alt="局部截取_20251208_135819" src="https://github.com/user-attachments/assets/dbd48fc6-bf56-4cec-a838-f90a28734b59" />

发送到「System Message」频道，采用橙色主题卡片样式：
**发奖者（抽奖创建者）收到的通知：**
```
🎉 Giveaway Draw Completed!                    [时间戳]
Your giveaway "[标题]" has been drawn successfully!
Winner: [中奖者用户名]
Please deliver the prize in-game in 14 days and confirm handover.

[VIEW DETAILS(抽奖详情页入口)]
```

**中奖者收到的通知：**
```
🎊 Congratulations! You Won!                   [时间戳]
You won "[奖品名称]" from [发奖者用户名]'s giveaway!
Please contact the host to receive your prize in 14 days.

[VIEW DETAILS]
```

##### 4.1.2 用户聊天会话
<img width="1059" height="529" alt="局部截取_20251208_135858" src="https://github.com/user-attachments/assets/3818bd24-b16c-435e-aab7-bacb06121ecb" />

系统自动创建发奖者与中奖者的一对一聊天，包含抽奖主要信息卡片，并展示领奖倒计时（从开奖算起超过14天即变为expired，不支持再领奖）
```
+-------------------------------------------------------------+
| Giveaway #[ID短码]                          View Details    |
+-------------------------------------------------------------+
| [奖品图片]                                                   |
|                                                              |
| Prize Delivery                                               |
| [中奖者] won [奖品名称] from this giveaway.                  |
| Please handover the prize in-game in 14 days, and upload the |
| screenshot to **CONFIRM HANDOVER**.                        |
|                              [UPLOAD]                       |
+-------------------------------------------------------------+
```

**卡片字段说明：**
- Giveaway ID短码
- View Details：跳转giveaway详情页
- 奖品图片：显示中奖的道具，交互与交易格子中道具、token一致（hover信息卡片、弹窗）
- UPLOAD：点击拉起「确认交接弹窗」


##### 4.1.3 确认交接弹窗
发奖者与中奖者均可点击"确认交接"按钮，在弹窗中上传交接截图（发奖者必须上传图片，中奖者可选），并输入一句话（可选）。
如一方已完成确认交接，则其所有入口中"UPLOAD"按钮状态变为"HANDOVER CONFIRMED"，不支持点击。
注意：用户中心中的抽奖卡片的操作按钮状态与这里联动，任一地方操作，均统一切换状态。

| 角色 | 截图上传 | 备注填写 | 操作必要性 |
|------|---------|---------|-----------|
| 发奖者 | 必填 | 选填 | 必须操作确认 |
| 中奖者 | 选填 | 选填 | 可选操作 |

**弹窗UI设计**
```
+-------------------------------------------------------------+
|                    Confirm Prize Handover                    |
|                           ✕                                 |
+-------------------------------------------------------------+
| Giveaway: [抽奖标题]                                         |
| Prize: [奖品名称] x [数量]                                   |
| Winner: [中奖者用户名]                                       |
+-------------------------------------------------------------+
| Upload Screenshot *                                          |
| [拖拽上传 或 点击选择图片]                                 |
| (Required for prize giver / Optional for winner)             |
+-------------------------------------------------------------+
| Warm Words to [中奖者/发奖者昵称] (Optional)                 |
| [文本输入框，限制100字符]                                      |
+-------------------------------------------------------------+
|                    [CANCEL]    [CONFIRM]                     |
+-------------------------------------------------------------+
```

#### 4.2 领奖有效期与过期失效机制

##### 领奖有效期
- **有效期**：开奖后14天内
- **生效条件**：任一方（发奖者或中奖者）完成确认交接操作即视为交接完成

##### 过期失效规则
如果开奖后14天内双方均未操作确认交接，系统自动执行以下操作：

1. **抽奖状态变更**：从`ended`变为`expired`
2. **聊天会话失效**：发奖者与中奖者的对话窗口自动消失/隐藏
3. **系统通知清除**：中奖提示的系统通知消失
4. **入口失效**：用户中心中确认交接入口变为不可操作状态，文案相应变化 UPLOAD->Expired
5. **中奖者失去领奖资格**：不再支持领取奖品

##### 用户提示
- 在参与确认弹窗中需展示领奖有效期说明
- 在中奖通知中明确标注领奖截止时间


#### 5. Giveaway列表页面
本期与双节活动需求合并，即常规Giveaway列表页基础上增加活动模块，待活动结束后可下线活动模块，聚合展示日常Giveaways（具体见Jiaming需求单）
- **展示维度**
  - 全站抽奖列表（按时间/热度排序）
  - 进行中/已结束分类

- **卡片设计**
  - 参考现有交易订单列表的长条卡片样式
  - 左侧：VIP头像、用户名
  - 中间：奖品缩略图、活动描述、参与条件
  - 右侧：参与人数、倒计时、操作按钮
  - 状态标签：待开始/进行中/已结束

#### 6. Giveaway详情页

##### 6.1 页面布局
```
+-------------------------------------------------------------+
|                    ← Back to Giveaways                       |
+-------------------------------------------------------------+
| [创建者头像]  Creator Name                                   |
|              @username · [Official] [Creator]                |
|              [FOLLOW] / [FOLLOWING]                          |
+-------------------------------------------------------------+
|                                                              |
| [大尺寸奖品图片]                                              |
|                                                              |
| 🎁 [奖品名称] x [数量]                                       |
| Value: [价值]                                                |
+-------------------------------------------------------------+
| [活动标签]  ONGOING / ENDED / EXPIRED                        |
|                                                              |
| [抽奖标题]                                                   |
| [抽奖描述完整内容...]                                         |
+-------------------------------------------------------------+
| 📅 Registration Period                                       |
| Start: Dec 10, 2025 10:00 AM                                |
| End:   Dec 15, 2025 10:00 AM                                |
|                                                              |
| ⏰ Draw Time: Dec 15, 2025 10:00 AM                         |
| (or 倒计时: Ends in 2d 5h 30m)                               |
+-------------------------------------------------------------+
| 👥 Participants: 156 users joined                            |
| [参与者头像列表，最多显示10个 + "and 146 more"]               |
+-------------------------------------------------------------+
| [JOIN NOW] / [JOINED ✓] / [VIEW RESULT]                     |
| [SHARE 🔗]                                                   |
+-------------------------------------------------------------+

--- 以下为已结束状态时显示 ---

+-------------------------------------------------------------+
| 🎉 Winner                                                    |
| [中奖者头像] Winner Name @username                           |
| Won on: Dec 15, 2025 10:00 AM                               |
| Claim Deadline: Dec 29, 2025 10:00 AM                       |
| Status: [Pending / Claimed / Expired]                        |
+-------------------------------------------------------------+

--- 以下为已完成交接时显示（任一方上传了截图） ---

+-------------------------------------------------------------+
| ✨ Prize Handover Complete!                                  |
+-------------------------------------------------------------+
| [发奖者截图]              |  [中奖者截图（如有）]            |
| "发奖者的一句话..."       |  "中奖者的一句话..."            |
| — @giver_name            |  — @winner_name                |
+-------------------------------------------------------------+
| 🎊 Another successful giveaway on GAG!                      |
+-------------------------------------------------------------+
```

##### 6.2 详情页字段说明

| 区域 | 字段 | 说明 |
|-----|-----|-----|
| **创建者信息** | 头像、用户名、标签 | 最多显示8个标签 |
| | 关注按钮 | 根据关注状态显示 |
| **奖品信息** | 奖品图片（大图） | 点击可查看道具详情弹窗 |
| | 奖品名称、数量、价值 | |
| **活动信息** | 活动标签(Campaign) | 如关联了运营活动则显示 |
| | 状态标签 | ONGOING/ENDED/COMPLETED/EXPIRED |
| | 标题、描述 | 完整展示 |
| **时间信息** | 报名时间段 | 起止时间 |
| | 开奖时间/倒计时 | 未开奖显示倒计时，已开奖显示实际时间 |
| **参与信息** | 参与人数 | |
| | 参与者头像 | 最多10个 + "and X more" |
| **操作按钮** | JOIN NOW | 可参与时 |
| | JOINED ✓ | 已参与（禁用态） |
| | VIEW RESULT | 已结束时 |
| | SHARE | 始终可见 |
| **中奖信息** | 中奖者信息 | 仅已结束时显示 |
| | 领奖截止时间 | |
| | 领奖状态 | Pending/Claimed/Expired |
| **交接展示** | 双方截图 | 仅已完成交接时显示 |
| | 双方留言 | 增加社区氛围感 |

##### 6.3 交接展示设计要点
- **仅当任一方上传了截图时**才显示交接区域
- 如双方都未上传，则隐藏整个交接模块
- 设计要体现**真实感和社区氛围**，鼓励用户参与
- 截图可点击放大查看
- 留言区域采用引用样式，突出用户发言

##### 6.4 不同状态下的详情页差异

| 状态 | 操作按钮 | 中奖区域 | 交接区域 |
|-----|---------|---------|---------|
| ongoing | JOIN NOW / JOINED | 隐藏 | 隐藏 |
| ended（待交接） | VIEW RESULT | 显示中奖者，状态Pending | 隐藏 |
| completed（已交接） | VIEW RESULT | 显示中奖者，状态Claimed | 显示截图和留言 |
| expired（已过期） | VIEW RESULT | 显示中奖者，状态Expired | 隐藏 |

#### 7. 用户中心抽奖卡片操作按钮状态

用户中心"动态"tab中的抽奖卡片操作按钮需与聊天中的交接操作状态联动。

##### 7.1 主态（我创建的抽奖）操作按钮

| 抽奖状态 | 交接状态 | 按钮文案 | 可操作 | 说明 |
|---------|---------|---------|:------:|-----|
| ongoing | - | VIEW | ✅ | 查看详情 |
| ended | pending | CONFIRM HANDOVER | ✅ | 点击拉起交接弹窗 |
| ended | handover_submitted (对方已确认) | HANDOVER CONFIRMED | ❌ | 禁用态 |
| completed | completed | HANDOVER CONFIRMED | ❌ | 禁用态 |
| expired | - | Expired | ❌ | 禁用态，灰色文字 |

##### 7.2 客态（我参与的抽奖）操作按钮

| 抽奖状态 | 是否中奖 | 交接状态 | 按钮文案 | 可操作 | 说明 |
|---------|---------|---------|---------|:------:|-----|
| ongoing | - | - | JOINED | ❌ | 禁用态 |
| ended | 否 | - | VIEW | ✅ | 查看详情 |
| ended | 是 | pending | CONFIRM HANDOVER | ✅ | 点击拉起交接弹窗（中奖者可选上传） |
| ended | 是 | handover_submitted | HANDOVER CONFIRMED | ❌ | 禁用态 |
| completed | 是 | completed | HANDOVER CONFIRMED | ❌ | 禁用态 |
| expired | 是 | - | Expired | ❌ | 禁用态，灰色文字 |

##### 7.3 状态联动规则

1. **统一状态源**：用户中心卡片按钮状态与聊天中UPLOAD按钮状态**共享同一数据源**（giveaway_handovers表）
2. **实时同步**：任一入口完成交接操作，所有入口按钮状态同步更新
3. **角色差异**：
   - 发奖者：必须上传截图才能确认交接
   - 中奖者：可选上传截图，确认操作可选
4. **过期处理**：到期自动将所有入口按钮变为Expired状态



---

## 📋 四、Giveaway 字段表

> 本节抽象出 Giveaway 的完整字段，区分业务逻辑字段与展示字段，供不同场景（个人中心/用户主页tab中或抽奖列表中的长条形卡片、方形卡片、抽奖详情页）选择使用。

### 字段分类说明
- **业务逻辑字段**：后端存储、业务计算所需
- **展示字段**：前端UI展示所需，部分为计算/派生字段

### 完整字段表

| 字段名 | 字段说明 | 业务逻辑 | 长条卡片 | 方形卡片(日历hover) | 详情页 | 备注 |
|--------|----------|:--------:|:--------:|:-------------------:|:------:|------|
| **基础信息** |
| id | 抽奖活动唯一标识 | ✅ | - | - | - | UUID |
| title | 活动标题 | ✅ | ✅ | ✅ | ✅ | 限制50字符 |
| description | 活动描述/说明 | ✅ | 摘要 | - | ✅完整 | 限制500字符 |
| status | 活动状态 | ✅ | ✅ | ✅ | ✅ | created/ongoing/drawing/ended/completed/expired/cancelled |
| **创建者信息** |
| creator_id | 创建者用户ID | ✅ | - | - | - | 关联user表 |
| creator_avatar | 创建者头像URL | - | ✅ | ✅ | ✅ | 从user表获取 |
| creator_name | 创建者用户名 | - | ✅ | ✅ | ✅ | 从user表获取 |
| creator_tags | 创建者标签 | - | ✅(3个+more) | - | ✅(最多8个) | 从user_tags表获取 |
| is_following | 当前用户是否已关注创建者 | - | ✅ | - | ✅ | 运行时计算 |
| **奖品信息** |
关联token或道具数据表（需展示奖品名称、图片、value+token数量、宠物年龄、体重、变异；用道具信息卡片和弹窗）
| **时间信息** |
| created_at | 创建时间 | ✅ | ✅ | - | ✅ | 展示"X ago"格式 |
| draw_time | 开奖时间 | ✅ | ✅ | ✅ | ✅ | 定时开奖触发时间 |
| ended_at | 实际结束时间 | ✅ | - | - | ✅ | 开奖完成时间 |
| countdown_text | 倒计时文案 | - | ✅ | ✅ | ✅ | 计算字段："Ends in 2h 30m" |
| time_status | 时间状态标签 | - | ✅ | ✅ | - | "FAIR"/"ONGOING"/"ENDED" |
| campaign_tag | 关联活动标签 | ✅ | ✅ | ✅ | ✅ | 管理端配置，标签样式显示，不可点击 |
| **参与信息** |
| winner_count | 中奖人数上限 | ✅ | ✅ | ✅ | ✅ | 默认1 |
| participant_count | 当前参与人数 | - | ✅ | ✅ | ✅ | 计算字段 |
| is_participated | 当前用户是否已参与 | - | ✅ | - | ✅ | 运行时计算 |
| my_participation_time | 我的参与时间 | - | - | - | ✅ | 仅已参与时显示 |
| **中奖信息（已结束时）** |
| winners | 中奖者列表 | ✅ | - | - | ✅ | 关联giveaway_winners表 |
| winner_avatars | 中奖者头像 | - | ✅(最多3个) | - | ✅(全部) | 从user表获取 |
| winner_names | 中奖者用户名 | - | - | - | ✅ | 从user表获取 |
| is_winner | 当前用户是否中奖 | - | ✅ | - | ✅ | 运行时计算 |
| my_prize | 我的奖品信息 | - | - | - | ✅ | 仅中奖时显示 |
| claim_status | 领奖状态 | ✅ | - | - | ✅ | pending/claimed/expired |
| claim_deadline | 领奖截止时间 | ✅ | - | - | ✅ | 中奖后14天 |
| **交接信息（已中奖时）** |
| handover_status | 交接状态 | ✅ | - | - | ✅ | pending/handover_submitted/completed |
| giver_screenshot_url | 发奖者交接截图 | ✅ | - | - | ✅ | 发奖者必填 |
| giver_note | 发奖者交接备注 | ✅ | - | - | ✅ | 选填，限100字符 |
| winner_screenshot_url | 中奖者交接截图 | ✅ | - | - | ✅ | 中奖者选填 |
| winner_note | 中奖者交接备注 | ✅ | - | - | ✅ | 选填，限100字符 |
| can_confirm_handover | 是否可确认交接 | - | - | - | ✅ | 计算字段：已中奖且交接未完成 |
| **交互字段** |
| can_participate | 是否可参与 | - | ✅ | - | ✅ | 计算字段：状态ongoing且未参与 |
| action_button_text | 操作按钮文案 | - | ✅ | - | ✅ | "JOIN NOW"/"JOINED"/"VIEW"/"CLAIM" |
| action_button_state | 操作按钮状态 | - | ✅ | - | ✅ | enabled/disabled/loading |
| share_url | 分享链接 | - | ✅ | - | ✅ | 生成的分享URL |

### 不同场景的展示重点

#### 1. 长条卡片（抽奖列表/抽奖Tab）
主要展示：创建者信息、奖品缩略、参与统计、倒计时、操作按钮
- 适用场景：Giveaway列表页、用户主页动态Tab
- 信息密度：中等，需快速浏览

#### 2. 方形卡片（日历Hover）
主要展示：标题、状态、奖品、倒计时
- 适用场景：抽奖日历hover时的信息预览
- 信息密度：低，仅关键信息

#### 3. 详情页
主要展示：完整信息，包括完整描述、所有奖品、参与者列表、中奖结果
- 适用场景：点击卡片进入的详情页面
- 信息密度：高，完整展示

---

## 🗺️ 五、用户旅程与逻辑图

### 主态（创建者视角）

#### 用户旅程
```
创建者（VIP用户/有抽奖权限的用户）视角下的完整流程：

1. 发现入口
   ├─ 个人主页 → 动态Tab → 「Create Giveaway」按钮
   └─ 全站 Giveaway 列表页 → 「Create」按钮（仅有权限用户可见）

2. 创建抽奖
   ├─ 填写标题、描述
   ├─ 选择奖品（从道具库选择，支持多个）
   ├─ 设置开奖时间
   ├─ 设置中奖人数
   └─ 提交创建

3. 管理抽奖（进行中）
   ├─ 查看实时参与人数
   ├─ 查看粉丝增长数据
   ├─ 分享抽奖链接
   └─ 提前结束/开奖（可选）

4. 查看结果（已结束）
   ├─ 查看中奖者列表
   ├─ 查看奖品发放状态
   └─ 查看活动统计数据
```

#### 主态页面状态

| 页面位置 | 进行中状态 | 已结束状态 |
|---------|-----------|-----------|
| 动态Tab卡片 | 显示参与人数、倒计时、「Share」按钮 | 显示参与人数、中奖者头像、「View」按钮 |
| 详情页 | 参与者列表（实时更新）、「End Early」按钮 | 中奖者列表、奖品发放状态、统计数据 |

### 客态（参与者视角）

#### 用户旅程
```
普通用户参与抽奖的完整流程：

1. 发现抽奖
   ├─ 首页推荐
   ├─ Giveaway 列表页（支持筛选：全部/关注的VIP/进行中）
   ├─ 抽奖日历（按日期查看）
   └─ VIP用户主页 → 动态Tab

2. 浏览抽奖
   ├─ 查看卡片信息（奖品、参与人数、倒计时）
   └─ 点击进入详情页查看完整信息

3. 参与抽奖
   ├─ 点击「JOIN NOW」按钮
   ├─ 系统检测关注状态
   │   ├─ 已关注 → 直接参与成功
   │   └─ 未关注 → 自动关注VIP → 参与成功
   ├─ Toast提示"Successfully joined!"
   └─ 按钮变为「JOINED」（禁用态）

4. 等待开奖
   ├─ 在"我参与的抽奖"列表查看
   └─ 关注倒计时

5. 查看结果
   ├─ 中奖 → 收到通知 → 查看奖品 → 领取奖品
   └─ 未中奖 → 获得参与积分 → 查看其他抽奖
```

#### 客态页面状态

| 页面位置 | 未参与 | 已参与 | 已结束-未中奖 | 已结束-中奖 |
|---------|--------|--------|--------------|------------|
| 列表卡片 | 「JOIN NOW」按钮 | 「JOINED」(禁用) | 「VIEW」按钮 | 「VIEW」按钮 + 🎉标识 |
| 详情页 | 完整信息 + 「JOIN NOW」 | 完整信息 + 参与确认 | 中奖者列表 | 中奖提示 + 「CLAIM」按钮 |

### 参与抽奖核心逻辑图

```
┌─────────────────────────────────────────────────────────────────┐
│                     用户点击「JOIN NOW」                          │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
                    ┌─────────────────┐
                    │   是否已登录？    │
                    └─────────────────┘
                       │           │
                      否           是
                       │           │
                       ▼           ▼
              ┌─────────────┐  ┌─────────────────┐
              │ 跳转登录页面  │  │ 抽奖状态是否为   │
              │ 登录后返回   │  │ "ongoing"？      │
              └─────────────┘  └─────────────────┘
                                  │           │
                                 否           是
                                  │           │
                                  ▼           ▼
                          ┌───────────┐  ┌─────────────────┐
                          │ 显示错误   │  │ 是否已参与？     │
                          │ 活动已结束 │  └─────────────────┘
                          └───────────┘     │           │
                                           是           否
                                            │           │
                                            ▼           ▼
                                    ┌───────────┐  ┌─────────────────┐
                                    │ 显示提示   │  │ 是否已关注VIP？  │
                                    │ 您已参与   │  └─────────────────┘
                                    └───────────┘     │           │
                                                     是           否
                                                      │           │
                                                      │           ▼
                                                      │   ┌───────────────┐
                                                      │   │ 自动关注VIP    │
                                                      │   │ 创建关注记录   │
                                                      │   └───────────────┘
                                                      │           │
                                                      ▼           ▼
                                              ┌─────────────────────────┐
                                              │     创建参与记录         │
                                              │  giveaway_participants  │
                                              └─────────────────────────┘
                                                          │
                                                          ▼
                                              ┌─────────────────────────┐
                                              │     参与成功             │
                                              │  - Toast提示            │
                                              │  - 按钮变为「JOINED」    │
                                              │  - 参与人数+1           │
                                              └─────────────────────────┘
```

### 开奖逻辑图（系统自动）

```
┌─────────────────────────────────────────────────────────────────┐
│               定时任务触发（到达 draw_time）                       │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
                    ┌─────────────────┐
                    │ 更新状态为       │
                    │ "drawing"       │
                    └─────────────────┘
                              │
                              ▼
                    ┌─────────────────┐
                    │ 获取有效参与者    │
                    │ (已关注+已参与)  │
                    └─────────────────┘
                              │
                              ▼
                    ┌─────────────────┐
                    │ 参与者数量 > 0？ │
                    └─────────────────┘
                       │           │
                      否           是
                       │           │
                       ▼           ▼
              ┌─────────────┐  ┌─────────────────────┐
              │ 标记为无有效  │  │ 随机抽取winner_count │
              │ 参与者结束   │  │ 个获奖者             │
              └─────────────┘  └─────────────────────┘
                                          │
                                          ▼
                              ┌─────────────────────┐
                              │ 创建中奖记录         │
                              │ giveaway_winners    │
                              │ 设置claim_deadline  │
                              └─────────────────────┘
                                          │
                                          ▼
                              ┌─────────────────────┐
                              │ 发送中奖通知         │
                              │ - 站内消息          │
                              │ - 邮件（可选）       │
                              └─────────────────────┘
                                          │
                                          ▼
                              ┌─────────────────────┐
                              │ 更新状态为           │
                              │ "completed"         │
                              │ 记录ended_at        │
                              └─────────────────────┘
```

---

## 🎨 UI/UX设计方向

### 设计风格：社交优先型 + 长条卡片

#### 核心设计原则
1. **社交互动优先**：VIP与粉丝关系是核心
2. **信息密度适中**：长条卡片提升浏览效率
3. **视觉统一**：与现有交易订单列表风格一致
4. **快速操作**：减少点击步骤，提升转化

#### 关键页面布局

##### 1. VIP个人主页（参考截图1）
```
+-----------------------------------+
| 左侧导航栏    |  顶部用户信息卡片      |
| - 动态        |  [头像] User Name     |
| - 交易        |  Following: xxx  Followed: xxx |
| - 收藏        |  标签1 标签2 标签3    |
| - 宠物背包    |  个人简介...          |
|              |  [Follow按钮]         |
+-----------------------------------+
|              | Ongoing Giveaways    |
|              | [长条抽奖卡片1]       |
|              | [长条抽奖卡片2]       |
|              |                      |
|              | Past Giveaways       |
|              | [长条抽奖卡片3]       |
+-----------------------------------+
```

##### 2. 长条抽奖卡片（参考截图2交易列表样式）
```
+-------------------------------------------------------------+
| [VIP头像] VIP Name      [奖品图]  Requirements: 50 users    |
|           Published     奖品名称   [进度条 70%]  [JOIN NOW] |
|           1 minute ago             36 users joining!  Share  |
+-------------------------------------------------------------+

状态变化：
- 进行中：JOIN NOW按钮 + 倒计时
- 已结束：VIEW按钮 + "75 users joined!"
```

##### 3. 抽奖列表页面
```
+-----------------------------------+
|     LATEST GIVEAWAYS             |
|  [筛选] 全部 | 关注的VIP | 进行中  |
+-----------------------------------+
| [长条抽奖卡片1 - ONGOING]        |
| [长条抽奖卡片2 - FAIR]           |
| [长条抽奖卡片3 - ENDED]          |
+-----------------------------------+
```

#### 核心交互流程

##### 参与抽奖流程
```
1. 用户浏览抽奖列表
   ↓
2. 点击"JOIN NOW"按钮
   ↓
3. 检测关注状态
   ├─ 已关注 → 直接参与成功
   └─ 未关注 → 自动关注 → 参与成功
   ↓
4. Toast提示"参与成功！"
5. 按钮变为"已参与"（禁用状态）
6. 参与人数+1，进度条更新
```
-

---

## 📈 成功指标（MVP阶段）

### 核心指标
1. **抽奖活跃度**
   - 目标：每周至少10个VIP创建抽奖
   - 目标：平均每个抽奖吸引50+用户参与

2. **用户参与度**
   - 目标：用户参与抽奖转化率 > 30%
   - 目标：通过抽奖带来的新关注转化率 > 50%

3. **系统稳定性**
   - 目标：定时开奖成功率 > 99%
   - 目标：页面加载时间 < 2秒

### 数据监控
- 每日活跃抽奖数
- 用户参与次数
- VIP粉丝增长数
- 奖品发放成功率


---

## 📝 附录

### A. 术语表
- **VIP用户**：拥有平台特权的用户角色（团队成员、KOL、游戏开发者等），由运营在管理后台授予
- **普通用户**：平台默认角色，新注册用户自动分配
- **抽奖权限**：`create_giveaway` 功能权限，VIP用户默认拥有，普通用户可通过申请获得
- **道具库**：游戏内可交易的虚拟物品集合
- **参与积分**：用户参与抽奖累积的积分（暂不可兑换）
- **主态**：用户查看自己创建的抽奖活动
- **客态**：用户查看他人创建的抽奖活动

### B. 参考资料
- 前置需求：「用户隐私设置PRD」（用户体系、角色、权限、标签）
- 原始需求文档：[抽奖功能.pdf]
- UI设计参考：截图1（个人主页）、截图2（交易列表）
- 技术文档：Lovable Cloud官方文档
- 竞品分析：Twitter Giveaways, Discord Events

### C. 变更记录
| 版本 | 日期 | 变更内容 | 负责人 |
|------|------|---------|--------|
| v1.0 | 2025-11-30 | 初始版本，完成MVP需求定义 | AI Product Manager |
| v1.1 | 2025-12-05 | 与用户隐私PRD对齐：更新角色体系、权限申请入口；新增Giveaway字段表、用户旅程与逻辑图 | AI Product Manager |
| v1.2 | 2025-12-08 | 新增奖品交接流程：聊天系统集成、确认交接弹窗、7天提醒机制、giveaway_handovers表 | AI Product Manager |
| v1.3 | 2025-12-08 | 新增关联活动字段（campaign_tag），管理端手动配置，标签样式展示 | AI Product Manager |
| v1.4 | 2025-12-09 | 重大更新：(1) 参与确认弹窗流程 (2) 粉丝铭牌`[Avatar] Fan`设计，14天有效期 (3) 抽奖时间限制30天 (4) 领奖有效期14天 (5) 新增状态ended/expired，调整completed为已交接 (6) 关联活动下拉选择 (7) 移除二次提醒，改为过期失效机制 | AI Product Manager |

---

**文档状态**：✅ 已确认  
**最后更新**：2025-12-09  

