# 抽奖功能产品需求文档 (PRD) v1.7

## 📋 一、概述

### 核心价值
- **平台运营**：提升用户活跃度和留存率，建立健康的社交生态
- **VIP创作者**：通过抽奖活动吸引和维护粉丝群体，提升个人影响力
- **普通用户**：通过关注喜爱的VIP获得奖品机会，享受参与乐趣

### 上线目标
在**2025年12月20日前**，以便支持双节活动上线。

### 关注
本期设计实现方案时，应考虑拓展性，即未来能相对容易的兼容平台新增其他游戏的抽奖活动。

---

## 👥 二、用户角色

### 1. VIP用户（抽奖发起者）
**画像**：平台活跃的内容创作者、交易大户、社区意见领袖

**核心需求**：快速创建抽奖活动，选择奖品和设置规则，简化的定时开奖机制；通过抽奖吸引新粉丝关注 

### 2. 普通用户（参与者）
**画像**：平台活跃用户，对游戏道具有需求，喜欢社交互动

**核心需求**：快速发现感兴趣的抽奖活动，一键参与抽奖（自动关注VIP）；查看自己参与的抽奖记录，了解结果与状态

### 3. 平台运营
**核心需求**：手动审核和授予VIP权限；后续数据分析和运营决策支持

---

## 🎯 三、功能需求拆分

### 前置条件（基础设施）

| 功能模块 | 功能描述 | 技术要点 |
|---------|---------|---------|
| **用户角色和权限分级** | 安全的角色权限管理 | 不同用户的功能权限区分 |
| **奖品库** | 道具、token数据管理 | 包括道具和token，及对应名称、图片、数量、价值等交易关键字段 |
| **关注系统** | 用户关注关系 | user_follows表，支持关注/取关 |

### P0：核心功能与逻辑

**主要流程**
<img width="1529" height="454" alt="局部截取_20251208_123956" src="https://github.com/user-attachments/assets/5060031f-0a6c-4e12-a534-a71d057ce037" />

**抽奖卡片示例**
<img width="973" height="312" alt="局部截取_20251209_140915" src="https://github.com/user-attachments/assets/7652f799-ff8c-418a-a274-a43abaef1c4d" />

#### 抽奖活动生命周期-状态定义
```
创建 → 进行中 → 开奖 → 已开奖 → 已交接/过期失效

状态说明：
- created: 刚创建，未开始 → "AWAITING START"
- ongoing: 进行中，即处于报名参与期 → "ONGOING"
- drawing: 正在开奖（锁定状态，不支持报名）——待讨论，如抽奖过程极短，不需要展示抽奖过程，则无需该状态
- ended: 已开奖，不管是否完成奖品交接都进入此状态 → "ENDED"
- completed: 已交接，任一方（发奖者或中奖者）完成确认交接即变更为此状态 → "COMPLETED"
- expired: 过期失效，开奖后14天内双方均未确认交接，则自动变为此状态 → "EXPIRED"
- （后续-支持取消）cancelled: 已取消 → "CANCELLED"

ex：
created → ongoing 切换时点 = 报名开始时间
ongoing → ended 切换时点 = 报名结束时间 = 开奖时间

状态互斥规则：
- ended与completed/expired互斥：开奖后先进入ended状态
- completed与expired互斥：以是否完成交接区分，只能存在一个
```
注意：
- 前端外显的状态名称只有"AWAITING START/ONGOING/ENDED"；completed/expired仅为后端内部状态，不影响前端状态标签展示，只要开奖后统一显示"ENDED"
- 所有外显的时间应统一，与value一样都需要转为UTC时间


以下为具体功能与逻辑：

#### 1. 个人主页-动态Tab中的Giveaway展示

> **说明**：个人主页动态Tab用于展示用户的抽奖活动，包括创建的抽奖和参与的抽奖。本期动态Tab文案暂时使用"Giveaways"。

<img width="2124" height="486" alt="企业微信截图_3e222f57-5aae-445d-9ac7-b2f1cbf59c92" src="https://github.com/user-attachments/assets/20a495cd-8ae6-4055-aebe-87b73fb4aff0" />

##### 1.1 展示内容与布局
- 使用 `GiveawayCard` 卡片组件
- 卡片布局：瀑布流式长条卡片，响应式
- 支持数字分页切换（使用组件），默认单页8个活动（待视觉稿确认）
- 按开奖时间倒序排列（越早的排下方），不同状态的抽奖展示对应状态标签

##### 1.2 分类展示与空状态

**分类展示规则**：
- 始终展示两个独立区域："Published" 和 "Participated"
- 两个区域各自独立处理空状态；每个区域有独立的分页
- 用户以主人态/访客态进入用户主页时，默认优先展示Giveaways的Participated tab内容

**分类说明**：
- **"Published"**：该用户创建的所有抽奖活动
  - 主态：展示自己创建的抽奖，小标题 "My Giveaways"
  - 客态：展示该用户创建的抽奖，根据隐私设置决定是否可见，标题 "[Username]'s Giveaways"
- **"Participated"**：该用户参与的抽奖活动
  - 主态：展示自己参与的抽奖，标题 "Participated Giveaways"
  - 客态：根据隐私设置决定是否可见，标题与上同
    
**布局说明**：
```
+-------------------------------------------------------------+
| [Published] [Participated]  ← 二级Tab切换                   |
+-------------------------------------------------------------+
| （主态小标题）My Giveaways / （客态）[Username]'s Giveaways  |
| [GiveawayCard] ...                                          |
| 或 空状态提示                                                |
+-------------------------------------------------------------+
| （主客态小标题）Participated Giveaways                       |
| [GiveawayCard]...                                           |
| 或 空状态提示                                                |
+-------------------------------------------------------------+
```

**空状态文案**：（无数据时的兜底）
| 区域 | 主人态空状态 | 访客态空状态 |
|------|-------------|-------------|
|发起抽奖(Published) | "No giveaways yet. Start your first one!" + 「CREATE GIVEAWAYS」按钮 | "No giveaways from this user yet." |
|参与的抽奖(Participated) | "You haven't joined any giveaways yet." + 「CHECK GIVEAWAYS」 | "No participated giveaways." + 「CHECK GIVEAWAYS」按钮|

- 「CREATE GIVEAWAYS」按钮:（交互见1.3部分）
- 「CHECK GIVEAWAYS」按钮：点击跳转giveaway聚合页


##### 1.3 创建抽奖与权限检查

> **说明**：VIP角色和抽奖功能权限由运营在管理后台授予，普通用户可通过Discord频道申请。

**点击创建流程**（主人态-Published区域）：
1. 用户点击「CREATE GIVEAWAYS」按钮
2. 系统检测用户是否有 `create_giveaway` 权限
3. **无权限**：弹窗提示需申请，引导跳转Discord频道申请
   - 弹窗标题：Want to Host Giveaways?
   - 描述：Ready to share amazing items with the community? Apply for giveaway permission on our Discord - only takes minutes!
   - 按钮：Maybe Later（取消） / Go to Discord（确认）     
4. **有权限**：进入创建抽奖流程，拉起创建抽奖弹窗（见1.4节）

- **审核流程**：用户在Discord频道提交申请，平台运营人工审核，通过后由运营在管理后台为用户添加抽奖权限


##### 1.4 VIP抽奖发起
- **创建抽奖活动**：拉起抽奖配置弹窗

**创建抽奖弹窗UI设计**
```
+-------------------------------------------------------------+
|                    Create Giveaway                           |
|                           ✕                                 |
+-------------------------------------------------------------+
| Prize *                                                      |
| [Select Prize]  ← 点击拉起道具选择器                          |
| (Choose one item from your inventory)                        |
+-------------------------------------------------------------+
| Joining Period *                                        |
| Start: [Date Picker] [Time Picker]                          |
| End:   [Date Picker] [Time Picker]                          |
| ⚠️ Draw time must be within 30 days from now                |
+-------------------------------------------------------------+
| Draw Time                                                    |
| [Auto-generated based on registration end time]  (Read-only) |
+-------------------------------------------------------------+
| Requirement                                                  |
| ✓ Follow you to participate (Default, can't be changed)    |
+-------------------------------------------------------------+
| Title *                                                      |
| [Enter giveaway title...]                                    |
| (Max 50 characters)                                          |
+-------------------------------------------------------------+
| Description                                                  |
| [Describe your giveaway...]                                  |
| (Optional, max 100 characters)                               |
+-------------------------------------------------------------+
| Related Campaign (Optional)                                  |
| [Select Campaign ▼]                                          |
| (Link to an ongoing platform campaign)                       |
+-------------------------------------------------------------+
|                    [CANCEL]    [CREATE]                      |
+-------------------------------------------------------------+
```

**字段说明：**
| 字段 | 必填 | 说明 |
|-----|-----|-----|
| Prize | ✅ | 使用道具选择组件，支持token或普通道具 |
| Title | ✅ | 活动标题，限50字符 |
| Description | ❌ | 活动描述，限500字符 |
| Joining Period | ✅ | 报名时间段，精确到分钟 |
| Draw Time | 自动 | 根据报名截止时间自动生成，不可修改 |
| Campaign | ❌ | 下拉选择运营预配置的活动名称 |
| Requirement | 默认 | 本期固定为"关注发奖者"，不可更改 |

**时间限制**：报名截止时间/开奖时间不能超过创建时间起30天，以保持活动节奏

- **查看抽奖活动**
  - 查看活动参与人数统计、活动状态等（用户中心动态tab、抽奖详情页）
  - （mvp阶段先不支持取消或编辑抽奖，后续再加-如报名开始之前可支持取消或修改）
 

#### 2. 用户参与抽奖
- **发现抽奖入口**
  - 首页顶部giveaway数量拉取入口（支持点击）、活动页（giveaway聚合页）的抽奖列表；用户主页的tab（已参与抽奖）

- **参与流程**
  1. **抽奖卡片点击「JOIN NOW」**：跳转至抽奖详情页
  2. **抽奖详情页**：抽奖信息、参与条件等
  3. **详情页点击「JOIN NOW」**：直接完成参与（无确认弹窗）
  
  - **未登录用户**：点击任意卡片中的「JOIN NOW」后跳转抽奖详情页，如继续点击详情页的「JOIN NOW」，则拉起登录/注册流程，登录完成后自动返回继续参与流程
  - **已登录用户**：点击详情页「JOIN NOW」后直接提示参与成功

- **参与成功后**：
  - 未关注则自动关注VIP
  - 获得粉丝铭牌（`[Avatar] Fan`样式，14天有效期）（P1-MVP版本不加粉丝铭牌）
  - 已关注则直接参与成功
  - 展示参与成功提示Toast："You're in! 🎉 Good luck!"
  - 按钮状态变更为「JOINED」（不可点击）

- **参与记录**
  - 个人中心：我参与的抽奖列表、抽奖活动状态

##### 2.1 参与条件
```
1. 用户必须已登录账号（未登录则先跳转登录页，登录后自动返回）
2. 用户必须关注该VIP（未关注则自动关注）
3. 抽奖活动处于"进行中"状态
4. 用户未重复参与同一抽奖
5. 用户并非该抽奖的创建者
```


##### 2.1 **粉丝铭牌（Fan Badge）**  （P1-MVP版本不加粉丝铭牌）
获取方式: 用户通过参与抽奖自动关注VIP时，获得该VIP的粉丝铭牌。
英文名称：Fan Badge

##### 展示样式
```
+-------------------+
| [VIP头像] Fan     |
+-------------------+
```
- 样式：圆形小头像 + "Fan" 文字
- 头像尺寸：与其他标签高度一致
- 点击行为：点击后跳转至该VIP的用户主页

##### 有效期
- 默认有效期：从获得之日起**14天**
- 过期后自动隐藏，不再展示

##### 展示位置与规则
粉丝铭牌与用户身份标签展示在同一位置：
1. **身份标签**（如Official等）固定在第一位
2. **粉丝铭牌**按获得时间倒序排列
3. **显示上限**：与其他标签一起计算总数（下方为标签总数），保持原有逻辑
   - 个人主页：最多8个（超出不展示）
   - 其他场景：最多3个（超出不展示）

##### 设计要点
- 视觉上需与身份标签有所区分，体现趣味性和社交属性；头像使设计上有辨识度，吸引其他用户点击查看。鼓励用户通过参与多个抽奖收集不同VIP的粉丝铭牌


#### 3. 定时开奖**
- **自动开奖机制**
  - 支持设定抽奖的报名时间范围，到报名时间截止时即为开奖时间，到时自动触发抽奖/开奖（同时）
  - 随机算法抽取获奖者（已关注且参与的用户，所有用户中奖机率相同；未来可考虑引入积分体系，增加中奖机率，本期不用）
  - 本期不校验开奖时用户是否仍要在关注中

- **开奖逻辑（MVP-定时开奖）**：
  1. 到达设定时间自动触发
  2. 检查有效参与者（已关注+已参与）
  3. 随机抽取指定数量获奖者
  4. 生成中奖记录
  5. 触发机制化的中奖通知
  6. 更新抽奖状态为`ended`

- **无参与者时的处理**：
  - 抽奖状态仍变为`ended`
  - 无中奖者记录生成
  - 不发送任何通知

- **未中奖用户处理**：保留参与记录


#### 4. 中奖通知与领取
**开奖后系统行为**：
```
开奖完成后，系统自动执行以下操作：

1. 创建中奖记录
2. 发送站内通知给中奖者（系统消息）
3. 发送站内通知给发奖者（系统消息）
4. 自动创建发奖者与中奖者的聊天会话（参考交易成功时拉起聊天的逻辑）

``` 
- **奖品领取**：双方通过聊天沟通游戏中奖品交接，并上传确认交接的截图
  

**领奖与交接流程** 集成聊天系统

##### 4.1.1 系统消息通知
<img width="1020" height="380" alt="局部截取_20251208_135819" src="https://github.com/user-attachments/assets/dbd48fc6-bf56-4cec-a838-f90a28734b59" />
仅中奖者和发奖者收到，其他未中奖参与者在个人中心查看参与的抽奖状态。

发送到「System Message」频道，采用橙色(或其他醒目颜色)主题卡片样式：
**发奖者（抽奖创建者）收到的通知：**
```
🎉 Giveaway Draw Completed!                    [时间戳]
Your giveaway "[标题]" has been drawn successfully!
Winner: [中奖者用户名]
Please deliver the prize in-game in **14 days** and confirm handover.
Big thanks from Tradekitsune!

[VIEW DETAILS(抽奖详情页入口)]
```

**中奖者收到的通知：**
```
🎊 Congratulations! You Won!                   [时间戳]
You won "[奖品名称]" from [发奖者用户名]'s giveaway!
Please contact the host to receive your prize in **14 days**.
Claim Deadline: [Date Time]

[VIEW DETAILS]
```

##### 4.1.2 用户聊天会话
<img width="1059" height="529" alt="局部截取_20251208_135858" src="https://github.com/user-attachments/assets/3818bd24-b16c-435e-aab7-bacb06121ecb" />

- 系统自动创建发奖者与中奖者的一对一聊天，包含抽奖主要信息卡片，并展示领奖倒计时
- 从开奖算起超过14天即过期，不支持再领奖：一对一聊天消失，仅在用户中心中能查看参与的抽奖卡片，按钮状态变为"Expired"
```
+-------------------------------------------------------------+
| 信息展示区                                               |
+-------------------------------------------------------------+
| Prize Delivery                                               |
| Please complete the prize delivery in-game within 14 days, then upload a screenshot to **CONFIRM HANDOVER**.|
|                              [UPLOAD]                       |
+-------------------------------------------------------------+
```

**抽奖信息展示区域说明：**
- Giveaway名称：支持点击跳转giveaway详情页
- 奖品图片：显示中奖的道具，交互与交易格子中道具、token一致（hover信息卡片、弹窗）
- 中奖者名称:"Winner: [中奖者]"
- 中奖时间
  

##### 4.1.3 确认交接弹窗
发奖者与中奖者均可点击"确认交接"按钮，在弹窗中上传交接截图（发奖者必须上传图片，中奖者可选），并输入一句话（可选）。
如一方已完成确认交接，则ta自己所有入口中"UPLOAD"按钮变为"HANDOVER CONFIRMED"状态，不支持点击。不影响另一方的按钮状态。
注意：用户中心中的抽奖卡片的操作按钮状态与这里联动，任一地方操作，均统一切换状态。

**弹窗UI设计**
```


+-------------------------------------------------------------+
|                    Confirm Prize Handover                    |
|                           ✕                                 |
+-------------------------------------------------------------+
|  Example Screenshots
|  截图示例文案+图片（支持点击放大）
| e.g. Photo with item / Trade screen
+-------------------------------------------------------------+
| Upload Screenshot *                                          |
| [拖拽上传 或 点击选择图片]                                  |
| Max 5 MB
+-------------------------------------------------------------+
| Warm Words to [中奖者/发奖者昵称] (Optional)                 |
| [(文本输入框) Max 100 characters]                                      |
+-------------------------------------------------------------+
|                    [CANCEL]    [CONFIRM]                     |
+-------------------------------------------------------------+
```

#### 4.2 领奖有效期与过期失效机制

##### 领奖有效期
- **有效期**：开奖后14天内
- **生效条件**：任一方（发奖者或中奖者）完成确认交接操作即视为交接完成

##### 过期失效规则
如果开奖后14天内双方均未操作确认交接，系统自动执行以下操作：

1. **抽奖状态变更**：从`ended`变为`expired`
2. **聊天会话失效**：发奖者与中奖者的对话窗口自动消失/隐藏
3. **系统通知清除**：中奖提示的系统通知消失
4. **入口失效**：用户中心中确认交接入口变为不可操作状态，文案相应变化 UPLOAD->Expired
5. **中奖者失去领奖资格**：不再支持领取奖品

##### 用户提示
- 在参与确认弹窗中需展示领奖有效期说明："Prize must be claimed within 14 days after draw."
- 在中奖通知中明确标注领奖截止时间："Claim Deadline: [Date]"


#### 5. Giveaway列表页面
URL规则：/growagarden/giveaways/

本期与双节活动需求合并，即常规Giveaway列表页基础上增加活动模块，待活动结束后可下线活动模块，聚合展示日常Giveaways（具体见Jiaming需求单）


#### 6. Giveaway详情页
URL规则：/growagarden/giveaways/抽奖标题slug

##### 6.1 页面布局（以下为字段示意，具体布局以视觉设计稿为准）
```
+-------------------------------------------------------------+
| 面包屑/Giveaway/抽奖标题                                     |
+-------------------------------------------------------------+
| [创建者头像]  发奖者名称                                      |
|              @username ·             [FOLLOW] / [FOLLOWING]       
|             [标签1] [标签2]...                               |
+-------------------------------------------------------------+
| [活动状态]                                                   |
| AWAITING START / ONGOING / ENDED                            |
| [抽奖标题]                                                   |
| [抽奖描述完整内容...]                                        | 
| [关联活动标签，如有...]                                      |
+-------------------------------------------------------------+|  
| [奖品图片]                                                    |
| 🎁 [奖品名称] x [数量]                                       |
| Value: [价值]                                               |  
| 宠物字段（变异、年龄、重量）                                  |                                           
+-------------------------------------------------------------+
| 📅 Joining Period                                       |
| Start: Dec 10, 2025 10:00 AM                                |
| End:   Dec 15, 2025 10:00 AM                                |
|                                                              |
| ⏰ Draw Time: Dec 15, 2025 10:00 AM                         |
| (or 倒计时: "Ends in 2d 5h 30m")                             |
+-------------------------------------------------------------+
| 👥 Participants: 156 users joined                            |
| [参与者头像列表，最多显示10个 + "and 146 more"]               |
| 无参与者时显示："Be the first to join!"                       |
| 无参与者建议2："No one joined yet. Be the first!"             |
+-------------------------------------------------------------+
| [COMING SOON] / [JOIN NOW] / [JOINED ✓]  /[ENDED]         |
+-------------------------------------------------------------+
| Discover More Giveaways                                      |
| 拉取更多抽奖的推荐模块：最多3条，选取AWAITING START和ONGOING中的抽奖，优先展示ONGOING的（按抽奖时间排列，越接近抽奖时间的排上方）;然后展示AWAITING START的。如都无符合条件的情况，则整个模块隐藏。
交互：点击标题行和底部More按钮，跳转至giveaway聚合页；卡片交互统一（组件）
+-------------------------------------------------------------+

--- 中奖者介绍：已结束/开奖状态时才显示，展示在奖品展示模块下方 ---
+-------------------------------------------------------------+
| 🎉 Winner                                                    |
| [中奖者头像] Winner Name @username                           |
| Won on: Dec 15, 2025 10:00 AM                               |
| Claim Deadline: Dec 29, 2025 10:00 AM                       |
+-------------------------------------------------------------+

---交接展示：以下为已完成交接时显示（任一方上传了截图），展示在中奖者介绍下方---

+-------------------------------------------------------------+
| ✨ Prize Handover Complete!                                  |
+-------------------------------------------------------------+
| [发奖者截图]              |  [中奖者截图（如有）]            |
| "发奖者的一句话..."       |  "中奖者的一句话..."            |
| — @giver_name            |  — @winner_name                |
+-------------------------------------------------------------+
| 🎊 Another successful giveaway on GAG!                      |
+-------------------------------------------------------------+
```

##### 6.2 详情页字段说明

| 区域 | 字段 | 说明 |
|-----|-----|-----|
| **创建者信息** | 头像、用户名、标签 | 最多显示8个标签 |
| | 关注按钮 | 根据访客的关注状态显示 |
| **奖品信息** | 奖品图片（大图） | hover信息卡片、点击可查看道具交易信息弹窗 |
| | 奖品名称、数量、value | |
| **活动信息** | 活动标签(Campaign) | 如关联了运营活动则显示 |
| | 状态标签 | ONGOING/ENDED/COMPLETED/EXPIRED |
| | 标题、描述 | 完整展示 |
| **时间信息** | 报名时间段 | 起止时间 |
| | 开奖时间/倒计时 | （具体见下方截图） |
| **参与信息** | 参与人数 | |
| | 参与者头像 | 最多10个 + "and X more" |
| **操作按钮** | JOIN NOW | 可参与时 |
| | JOINED ✓ | 已参与（禁用态） |
| | SHARE | 始终可见 |
| **中奖信息** | 中奖者信息 | 仅已结束时显示 |
| | 领奖截止时间 | |
| **交接展示** | 双方截图 | 仅已完成交接时显示 |
| | 双方留言 | 增加社区氛围感 |

**倒计时的逻辑**：
<img width="563" height="258" alt="局部截取_20251211_121725" src="https://github.com/user-attachments/assets/2a0984a6-4590-431a-996d-d7272ab7e061" />


##### 6.3 交接展示设计要点
- **仅当任一方上传了截图时**才显示交接区域
- 如双方都未上传，则隐藏整个交接模块
- 设计要体现**真实感和社区氛围**，鼓励用户参与；截图可点击放大查看
- 交接完成标题："Prize Handover Complete! 🎊"
- 交接模块底部文案："Another successful giveaway on Tradekitsune!"


##### 6.4 不同状态下的详情页差异
| 状态 | 操作按钮 | 中奖区域 | 交接区域 |
|-----|---------|---------|---------|
| created | AWAITING START | 隐藏 | 隐藏 |
| ongoing | JOIN NOW / JOINED | 隐藏 | 隐藏 |
| ended（待交接） | 无  | 显示中奖者，状态显示ended | 隐藏 |
| completed（已交接） | 无  | 显示中奖者，状态ended | 显示截图和留言 |
| expired（已过期） | 无  | 显示中奖者，状态ended | 隐藏 |

#### 7. 用户中心抽奖卡片操作按钮状态

用户中心"动态"tab中的抽奖卡片操作按钮需与聊天中的交接操作状态联动。

##### 7.1 主态（我创建的抽奖）操作按钮

| 抽奖状态 | 交接状态 | 按钮文案 | 可操作 | 说明 |
|---------|---------|---------|:------:|-----|
| created | - | VIEW | ✅ | 查看详情 |
| ongoing | - | VIEW | ✅ | 查看详情 |
| ended | pending | CONFIRM HANDOVER | ✅ | 点击拉起交接弹窗 |
| ended | handover_submitted (对方已确认) | CONFIRM HANDOVER | ✅ | 点击拉起交接弹窗 |
| completed | completed | HANDOVER CONFIRMED | ❌ | 禁用态 |
| expired | - | Expired | ❌ | 禁用态，灰色文字 |

##### 7.2 客态（我参与的抽奖）操作按钮

| 抽奖状态 | 是否中奖 | 交接状态 | 按钮文案 | 可操作 | 说明 |
|---------|---------|---------|---------|:------:|-----|
| ongoing | - | - | JOINED | ❌ | 禁用态 |
| ended | 否 | - | VIEW | ✅ | 查看详情 |
| ended | 是 | pending | CONFIRM HANDOVER | ✅ | 点击拉起交接弹窗（中奖者可选上传） |
| ended | 是 | handover_submitted |CONFIRM HANDOVER | ✅ | 点击拉起交接弹窗 |
| completed | 是 | completed | HANDOVER CONFIRMED | ❌ | 禁用态 |
| expired | 是 | - | Expired | ❌ | 禁用态，灰色文字 |

##### 7.3 状态联动规则

1. **统一状态源**：用户中心卡片按钮状态与聊天中UPLOAD按钮状态**共享同一数据源**（giveaway_handovers表）
2. **实时同步**：任一入口完成交接操作，所有入口按钮状态同步更新
3. **过期处理**：过期后自动将操作按钮变为"Expired"状态

##### 7.4 按钮文案汇总
| 英文文案 | 使用场景 |
|---------|---------|
| VIEW | 查看详情（通用） |
| JOIN NOW | 可参与时 |
| JOINED ✓ | 已参与（禁用态） |
| CONFIRM HANDOVER | 待确认交接 |
| HANDOVER CONFIRMED | 已完成交接（禁用态） |
| Expired | 已过期（禁用态，灰色） |
| SHARE | 分享按钮 |
| FOLLOW | 关注按钮 |
| FOLLOWING | 已关注（禁用态） |

---

## 📋 四、Giveaway 字段表

> 本节抽象出 Giveaway 的完整字段，区分业务逻辑字段与展示字段，供不同场景（个人中心/用户主页tab中或抽奖列表中的长条形卡片、方形卡片、抽奖详情页）选择使用。

### 字段分类说明
- **业务逻辑字段**：后端存储、业务计算所需
- **展示字段**：前端UI展示所需，部分为计算/派生字段

### 字段表（非全部枚举，以下字段名、数据表仅作示意，具体由研发根据实际已有数据表和命名规则而定）

| 字段名 | 字段说明 | 业务逻辑 | 长条卡片 | 方形卡片(日历hover) | 详情页 | 备注 |
|--------|----------|:--------:|:--------:|:-------------------:|:------:|------|
| **基础信息** |
| id | 抽奖活动唯一标识 | ✅ | - | - | - | UUID |
| title | 活动标题 | ✅ | ✅ | ✅ | ✅ | 限制50字符 |
| description | 活动描述/说明 | ✅ | 摘要 | - | ✅完整 | 限制500字符 |
| status | 活动状态 | ✅ | ✅ | ✅ | ✅ | created/ongoing/drawing/ended/completed/expired/cancelled |
| **创建者信息** |
| ？？ | 创建者用户ID | ✅ | - | - | - | 关联user表 |
| creator_avatar | 创建者头像URL | - | ✅ | ✅ | ✅ | 从user表获取 |
| creator_name | 创建者用户名 | - | ✅ | ✅ | ✅ | 从user表获取 |
| creator_tags | 创建者标签 | - | ✅(3个+more) | - | ✅(最多8个) | 从user_tags表获取 |
| **奖品信息** |
关联token或道具数据表（需展示奖品名称、图片、value+token数量、宠物年龄、体重、变异；用道具信息卡片和弹窗）
| **时间信息** |
| created_at | 创建时间 | ✅ | ✅ | - | ✅ | 展示"X ago"格式 |
| draw_time | 开奖时间 | ✅ | ✅ | ✅ | ✅ | 定时开奖触发时间 |
| ended_at | 实际结束时间 | ✅ | - | - | ✅ | 开奖完成时间 |
| countdown_text | 倒计时文案 | - | ✅ | ✅ | ✅ | 计算字段："Ends in 2h 30m" |
| time_status | 时间状态标签 | - | ✅ | ✅ | - | "AWAITING START"/"ONGOING"/"ENDED" |
| campaign_tag | 关联活动标签 | ✅ | ✅ | ✅ | ✅ | 管理端配置，标签样式显示，不可点击 |
| **参与信息** |
| winner_count | 中奖人数上限 | ✅ | ✅ | ✅ | ✅ | 默认1 |
| participant_count | 当前参与人数 | - | ✅ | ✅ | ✅ | 计算字段 |
| is_participated | 当前用户是否已参与 | - | ✅ | - | ✅ | 运行时计算 |
| my_participation_time | 我的参与时间 | - | - | - | ✅ | 仅已参与时显示 |
| **中奖信息（已结束时）** |
| winners | 中奖者列表 | ✅ | - | - | ✅ | 关联giveaway_winners表 |
| winner_avatars | 中奖者头像 | - | ✅(最多3个) | - | ✅(全部) | 从user表获取 |
| winner_names | 中奖者用户名 | - | - | - | ✅ | 从user表获取 |
| is_winner | 当前用户是否中奖 | - | ✅ | - | ✅ | 运行时计算 |
| my_prize | 我的奖品信息 | - | - | - | ✅ | 仅中奖时显示 |
| claim_status | 领奖状态 | ✅ | - | - | ✅ | pending/claimed/expired |
| claim_deadline | 领奖截止时间 | ✅ | - | - | ✅ | 中奖后14天 |
| **交接信息（已中奖时）** |
| handover_status | 交接状态 | ✅ | - | - | ✅ | pending/handover_submitted/completed |
| giver_screenshot_url | 发奖者交接截图 | ✅ | - | - | ✅ | 发奖者必填 |
| giver_note | 发奖者交接备注 | ✅ | - | - | ✅ | 选填，限100字符 |
| winner_screenshot_url | 中奖者交接截图 | ✅ | - | - | ✅ | 中奖者选填 |
| winner_note | 中奖者交接备注 | ✅ | - | - | ✅ | 选填，限100字符 |
| can_confirm_handover | 是否可确认交接 | - | - | - | ✅ | 计算字段：已中奖且交接未完成 |
| **交互字段** |
| can_participate | 是否可参与 | - | ✅ | - | ✅ | 计算字段：状态ongoing且未参与 |
| action_button_text | 操作按钮文案 | - | ✅ | - | ✅ | "JOIN NOW"/"JOINED"/"VIEW"/"CLAIM" |
| action_button_state | 操作按钮状态 | - | ✅ | - | ✅ | enabled/disabled/loading |
| share_url | 分享链接 | - | ✅ | - | ✅ | 生成的分享URL |

### 不同场景的展示重点

#### 1. 长条卡片（抽奖列表/抽奖Tab）
- 适用场景：Giveaway列表页、用户主页动态Tab
- 信息密度：中等，需快速浏览

#### 2. 方形卡片（日历Hover）
主要展示：标题、状态、奖品、倒计时
- 适用场景：抽奖日历hover时的信息预览
- 信息密度：低，仅关键信息

#### 3. 详情页
主要展示：完整信息，包括完整描述、所有奖品、参与者列表、中奖结果
- 适用场景：点击卡片进入的详情页面
- 信息密度：高，完整展示


## 📈 成功指标（MVP阶段）

### 核心指标
1. **抽奖活跃度**
   - 目标：平均每个抽奖吸引50+用户参与

2. **用户参与度**
   - 目标：聚合页列表中抽奖卡片曝光点击率 > 30%

### 数据监控
- 每日活跃抽奖数
- 用户参与次数
- VIP粉丝增长数
- 奖品发放成功率

---

## 📝 附录

### A. 术语表
- **VIP用户**：拥有平台特权的用户角色（团队成员、KOL、游戏开发者等），由运营在管理后台授予
- **普通用户**：平台默认角色，新注册用户自动分配
- **抽奖权限**：`create_giveaway` 功能权限，VIP用户默认拥有，普通用户可通过申请获得
- **道具库**：游戏内可交易的虚拟物品集合
- **参与积分**：用户参与抽奖累积的积分（暂不可兑换）
- **主态**：用户查看自己创建的抽奖活动
- **客态**：用户查看他人创建的抽奖活动

### B. 参考资料
- 前置需求：「用户隐私设置PRD」（用户体系、角色、权限、标签）
- 原始需求文档：[抽奖功能.pdf]
- UI设计参考：截图1（个人主页）、截图2（交易列表）
- 技术文档：Lovable Cloud官方文档
- 竞品分析：Twitter Giveaways, Discord Events

### C. 变更记录
| 版本 | 日期 | 变更内容 | 负责人 |
|------|------|---------|--------|
| v1.0 | 2025-11-30 | 初始版本，完成MVP需求定义 | AI Product Manager |
| v1.1 | 2025-12-05 | 与用户隐私PRD对齐：更新角色体系、权限申请入口；新增Giveaway字段表、用户旅程与逻辑图 | AI Product Manager |
| v1.2 | 2025-12-08 | 新增奖品交接流程：聊天系统集成、确认交接弹窗、7天提醒机制、giveaway_handovers表 | AI Product Manager |
| v1.3 | 2025-12-08 | 新增关联活动字段（campaign_tag），管理端手动配置，标签样式展示 | AI Product Manager |
| v1.4 | 2025-12-09 | 重大更新：(1) 参与确认弹窗流程 (2) 粉丝铭牌设计 (3) 抽奖时间限制30天 (4) 领奖有效期14天 (5) 状态体系调整 (6) 关联活动下拉选择 (7) 过期失效机制 | AI Product Manager |
| v1.5 | 2025-12-09 | 文档精简：(1) 补充无参与者开奖处理逻辑 (2) 删除用户旅程与逻辑图章节 (3) 删除UI/UX设计方向章节 (4) 修正开奖状态流转逻辑 | AI Product Manager |
| v1.6 | 2025-12-09 | 全面补充英文展示文案：状态标签、按钮文案、Toast提示、空状态文案、交接模块文案等 | AI Product Manager |

---

**文档状态**：✅ 已确认  
**最后更新**：2025-12-09  

